### 北京理工大学数学建模校赛A题-----工厂机器排班问题

#### 问题描述：

> 某工厂生产七种机械零件产品，零件1到零件7。该厂有五种机床设备，机床1到机床5，数量分别为6、3、4、2、1。每种零件的利润以及生产一个零件需要的各种机床设备的工时（单位：小时）如下表所示。

|       | 零件1 | 零件2 | 零件3 | 零件4 | 零件5 | 零件6 | 零件7 |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| 机床1 | 0.6   | 0.7   | 0     | 0.3   | 0.6   | 0     | 0.5   |
| 机床2 | 0.1   | 0.1   | 0     | 0.3   | 0     | 0.6   | 0     |
| 机床3 | 0.2   | 0     | 0.4   | 0     | 0.2   | 0     | 0.6   |
| 机床4 | 0.05  | 0.08  | 0     | 0.06  | 0.1   | 0     | 0.08  |
| 机床5 | 0     | 0     | 0.01  | 0     | 0.05  | 0.08  | 0.05  |

从一月到六月，每个月中需要整修的设备是（在整修的月份，被整修的设备全月不能用于生产）：
一月：2台机床1
二月：1台机床2
三月：1台机床4
四月：1台机床3
五月：1台机床1和1台机床2
六月：1台机床3和1台机床5

每个零件的利润：

| 零件1 | 零件2 | 零件3 | 零件4 | 零件5 | 零件6 | 零件7 |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| 10    | 9     | 3     | 5     | 11    | 9     | 8     |

每种零件的每个月市场销售量上限如下表所示：

| 零件1 | 零件2 | 零件3 | 零件4 | 零件5 | 零件6 | 零件7 |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| 600   | 800   | 200   | 0     | 700   | 300   | 200   |
| 500   | 600   | 300   | 300   | 500   | 200   | 250   |
| 200   | 500   | 400   | 200   | 500   | 0     | 300   |
| 300   | 400   | 0     | 400   | 300   | 500   | 100   |
| 0     | 200   | 300   | 200   | 900   | 200   | 0     |
| 400   | 300   | 100   | 300   | 800   | 400   | 100   |

每种零件的库存量最多为100个，每个零件的库存费用为0.5元/月。在上年末（一月初）的时候，所有零件库存量是0，但是要求在六月底时每种零件的库存量为60个。工厂的工人每天操作机床工作八小时，为简化问题，假定每月都工作22天。生产零件过程中各个工序没有次序要求，请建立数学模型并解决以下问题：
1、制定六个月的各种零件的生产库存销售计划使得总利润为最大。
2、如果工厂考虑投资扩大生产，假设每种机床投资相同，请给出如果可以投资购买新的机床设备数量为一台、两台、三台三种情况下应分别购买哪些机床设备及增加的利润（新买的机床不考虑整修）。
3、工厂是否可以通过不购买新设备而是改变前述机床设备整修方案来提高总利润？请构造一个机床设备整修计划数学模型，使原来计划整修的机床设备在这六个月中都得到整修，而使利润尽可能大。

#### 问题浅析

更进一步的分析将于论文中给出。
本问题的第二问和第三问都可视为对第一问初始条件更改情况下的第一问的求解。
由此确认关键在于确认第一问属于的数学模型。
考虑到如果把每月初看作一个数学节点，可以证明这个问题划归为无后效性问题。
贪心算法由于工厂在六月底必须剩余60个零件，因此最大化每月利润的贪心策略是错误的。
注意到所有题目中描述的变量之间的约束条件均由一次算式给出，因此确认本问题属于线性规划问题。

#### 模型假设

具体假设详见论文：在此只给出几个关键假设

1.零件要么在某个月被完整生成，要么就不生产
2.零件生产后如果要被销售，且有可销售额，那么一定会被销售
3.所有机器可并行运转

#### 线性规划求解

##### 常量定义：

hours = 8			每天可工作时长为8h

days   = 22			每月工作22天

fine    = 0.5			每月库存费

##### 变量定义：

$price_i$				第i件商品可获得的利润

$K_i$		        		第i月月初目前获得的利润

$X_(j,i)$				第i月月初，第j个零件的剩余量

$M_(j,i)$				第i月，第j个商品的生产量

$N_(j,i)$				第i月，第j个商品的销售量

$F_(j,i)$				第i月，第j个商品的销售限额

$Time_(j,num)$		第j个商品在第num号机器上所需的加工时间

$Machine_(num,i)$		第i月，第num号机器的数量

##### 目标函数

Max Z = $K_6$   +   $\sum^7_j$$_=$$_1$   $N_(j,6)$    *    $price_i$    -   $\sum$ fine * $X_(j,i)$

##### 约束函数

0 $\leq$ $X_(j,i)$ $\leq$ 100

$ X_(j,0) $ = 0

$X_(j,6)$ + $M_(j,6)$ - $N_(j,6)$ = 60

$X_(j,i+1)$ = $X_(j,i)$ + $M_(j,i)$ - $N_(j,i)$

$ K_0 $ = 0

$K_i$ $_+$ $_1$ = $K_i$ + $\sum^7_j$ $_=$ $_1$   $N_(j,i)$ *  $price_i$  -  $\sum^7_j$ $_=$ $_1$ fine * $X_(j,i)$

$N_(j,i)$ $\leq$ $F_(j,i)$

$N_(j,i)$ $\leq$ $X_(j,i)$ + $M_(j,i) $

$Time(i,num)$ * $M_(j,i)$ $\leq$ hours  *  days  *   $Machine_(num,i)$

##### 初始条件

$K_0=0$

$X_(j,1)$=0

$F_(j,i)$=

| 零件1 | 零件2 | 零件3 | 零件4 | 零件5 | 零件6 | 零件7 |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| 600   | 800   | 200   | 0     | 700   | 300   | 200   |
| 500   | 600   | 300   | 300   | 500   | 200   | 250   |
| 200   | 500   | 400   | 200   | 500   | 0     | 300   |
| 300   | 400   | 0     | 400   | 300   | 500   | 100   |
| 0     | 200   | 300   | 200   | 900   | 200   | 0     |
| 400   | 300   | 100   | 300   | 800   | 400   | 100   |

$Time_(j,num,i)$=

|       | 零件1 | 零件2 | 零件3 | 零件4 | 零件5 | 零件6 | 零件7 |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| 机床1 | 0.6   | 0.7   | 0     | 0.3   | 0.6   | 0     | 0.5   |
| 机床2 | 0.1   | 0.1   | 0     | 0.3   | 0     | 0.6   | 0     |
| 机床3 | 0.2   | 0     | 0.4   | 0     | 0.2   | 0     | 0.6   |
| 机床4 | 0.05  | 0.08  | 0     | 0.06  | 0.1   | 0     | 0.08  |
| 机床5 | 0     | 0     | 0.01  | 0     | 0.05  | 0.08  | 0.05  |

$Machine_(num,i)$	=

| 机器1 | 机器2 | 机器3 | 机器4 | 机器5 |
| ----- | ----- | ----- | ----- | ----- |
| 4     | 3     | 4     | 2     | 1     |
| 6     | 2     | 4     | 2     | 1     |
| 6     | 3     | 4     | 1     | 1     |
| 6     | 3     | 3     | 2     | 1     |
| 5     | 2     | 4     | 2     | 1     |
| 6     | 3     | 3     | 2     | 0     |

$price_i$=

| 零件1 | 零件2 | 零件3 | 零件4 | 零件5 | 零件6 | 零件7 |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| 10    | 9     | 3     | 5     | 11    | 9     | 8     |

#### 技术实现

使用pulp库实现并把问题集成为core内核方便调用，开放reset初始条件接口和solvep求解函数

#### 二三问技术实现

第二问和第三问本质上就是在一个较为庞大的数据量的可能性中寻找最大化问题1的初始条件，可以证明当问题的维度略微增加，数据量将会以指数级上升，因此枚举求解法是不现实的。
采用模型求解法
训练好模型->预测输入的输出->找最大值

#### 采用技术

主要采用了决策树与梯度提升树模型进行预测，在第二问程序文档中给出了模型法与枚举法的数量级差异，验证了思路的可行性。
通过将问题视为30特征值->float的问题，进一步抽象了本问题的实质，利用机器学习模型对这个抽象后的问题进行训练。
这一抽象同时可以利用numpy的性能优势加速模型训练。
再用训练好的模型进行预测。

#### 最终成果

决策树与梯度提升树的模型准确的均大于0.99，可以认为性能优秀，线性回归效果较好，认为模型在一定程度上几乎可以代表问题本身的内在逻辑的集成。

#### 正确性验证

在随机抽样的大量数据中。决策树与梯度提升树吻合度超过0.995，线性回归准确度超过95%，基本认为模型具备正确性

#### 致谢

感谢我的两位队友，使我获益良多，在此致谢
